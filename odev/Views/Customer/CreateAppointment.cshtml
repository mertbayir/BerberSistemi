@{
    Layout = "_LayoutCustomer.cshtml";
}

@model odev.Models.Appointment

<h2>Randevu Al</h2>

@{
    var barbers = ViewBag.Barbers;
}

<form asp-action="CreateAppointment" method="post">

    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            <p>Seçtiğiniz Randevu Uygun Değildir</p>
        </div>
    }

    <div>
        <label>Berber Seçin:</label>
        <select id="Name" name="BarberName" required onchange="updateSkills()">
            <option value="" disabled selected>Berber Seçin</option>
            @foreach (var barber in barbers)
            {
                <option value="@barber.Name" data-skills="@barber.Skills">@barber.Name</option>
            }
        </select>
    </div>

    <div>
        <label>Hizmet Seçin:</label>
        <select id="Skills" name="Service" required>
            <option value="" disabled selected>Hizmet Seçin</option>
        </select>
    </div>

    <!-- Tarih Seçimi -->
    <div>
        <label>Tarih:</label>
        <input type="date" name="Date" required />
    </div>

    <!-- Saat Seçimi -->
    <div>
        <label>Saat:</label>
        <select name="Time" required>
            <option value="" disabled selected>Saat Seçin</option>
            <option value="09:00">09:00</option>
            <option value="10:30">10:30</option>
            <option value="12:00">12:00</option>
            <option value="14:00">14:00</option>
            <option value="15:30">15:30</option>
            <option value="17:00">17:00</option>
        </select>
    </div>

    <button type="submit">Randevu Oluştur</button>
</form>

<script>
    function updateSkills() {
        var barberSelect = document.getElementById("Name");
        var barberName = barberSelect.value;

        // Berber seçeneklerini al
        var selectedBarber = Array.from(barberSelect.options).find(option => option.value === barberName);
        var skills = selectedBarber ? selectedBarber.getAttribute("data-skills") : "";

        // Hizmetler dropdown'ını temizle
        var skillsSelect = document.getElementById("Skills");
        skillsSelect.innerHTML = '<option value="" disabled selected>Hizmet Seçin</option>';

        if (skills) {
            // Berberin hizmetlerini virgülle ayırarak ekle
            var skillsList = skills.split(',');
            skillsList.forEach(function (skill) {
                var option = document.createElement("option");
                option.value = skill.trim();
                option.text = skill.trim();
                skillsSelect.appendChild(option);
            });
        }
    }
</script>
